---
import Navbar from "@/components/layout/Navbar.astro";
import Footer from "@/components/layout/Footer.astro";
import ScrollToTop from "@/components/layout/ScrollToTop.astro";
import WhatsAppButton from "@/components/layout/WhatsAppButton.astro";
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";

interface Props {
  title: string;
  description?: string;
  image?: string;
  transparent?: boolean;
}

const {
  title,
  description = "Fotografía profesional en Nicoya, Guanacaste y todo Costa Rica. Capturamos tus momentos más especiales: bodas, eventos, retratos y sesiones comerciales.",
  image = "/favicon.svg", // TODO: Reemplazar con una imagen real para compartir en redes (ej: /og-image.jpg)
  transparent = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const socialImageURL = new URL(image, Astro.url);
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO -->
    <title>{title} | GADEA ISO - Nicoya & Guanacaste</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <meta name="keywords" content="fotógrafo profesional costa rica, fotógrafo en nicoya, fotógrafo en guanacaste, fotografía de bodas, sesiones familiares, retratos empresariales, eventos corporativos, marca personal, sesiones de maternidad, fotografía comercial, gadea iso, joel gadea" />
    <meta name="author" content="Joel Gadea" />
    <meta name="robots" content="index, follow" />

    <!-- Geo Tags for Costa Rica -->
    <meta name="geo.region" content="CR-G" />
    <meta name="geo.placename" content="Nicoya, Guanacaste" />
    <meta name="geo.position" content="10.1444;-85.4517" />
    <meta name="ICBM" content="10.1444, -85.4517" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={socialImageURL} />
    <meta property="og:site_name" content="GADEA ISO" />
    <meta property="og:locale" content="es_CR" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={socialImageURL} />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "PhotographyBusiness",
      "name": "GADEA ISO",
      "image": socialImageURL.href,
      "url": "https://www.gadeafotografia.com",
      "telephone": "+50683518022",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Nicoya",
        "addressRegion": "Guanacaste",
        "addressCountry": "CR"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": 10.1444,
        "longitude": -85.4517
      },
      "sameAs": [
        "https://www.instagram.com/joelgadea_/",
        "https://www.facebook.com/profile.php?id=100073611974767&locale=es_LA",
        "https://share.google/JJ4g9NcRcFLmyBmbt"
      ],
      "priceRange": "$$"
    })} />

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://res.cloudinary.com" />

    <!-- ClientRouter para navegación SPA con transiciones -->
    <ClientRouter />

    <!-- Theme Script - Compatible con ClientRouter -->
    <script is:inline>
      // Función para aplicar el tema
      function applyTheme() {
        const theme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;

        if (theme === "dark" || (!theme && prefersDark)) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }

      // Aplicar tema inmediatamente
      applyTheme();

      // Escuchar eventos de navegación de View Transitions
      document.addEventListener("astro:after-swap", applyTheme);
    </script>
  </head>
  <body
    class="bg-white text-black/98 dark:text-white dark:bg-black transition-colors duration-300"
  >
    <Navbar transparent={transparent} />

    <main>
      <slot />
    </main>

    <Footer />
    <ScrollToTop />
    <WhatsAppButton phoneNumber="+50683518022" />
  </body>
</html>

<style is:global>
  html {
    scroll-behavior: smooth;
    scroll-padding-top: 80px; /* Compensar el navbar fixed */
  }

  body {
    min-height: 100vh;
  }

  /* Smooth scrollbar - Light Mode */
  ::-webkit-scrollbar {
    width: 10px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  ::-webkit-scrollbar-thumb {
    background: #000000;
    border-radius: 5px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #333333;
  }

  /* Smooth scrollbar - Dark Mode */
  .dark ::-webkit-scrollbar-track {
    background: #1a1a1a;
  }

  .dark ::-webkit-scrollbar-thumb {
    background: #666666;
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background: #888888;
  }
</style>
